generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int       @id @default(autoincrement())
  email      String    @unique
  phone      Int
  password   String
  username   String
  isVerified Boolean   @default(false)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  addresses  Address[]
  orders     Order[]

  @@map("user")
}

model Address {
  id        Int     @id @default(autoincrement())
  label     String
  detail    String
  latitude  Decimal
  longitude Decimal
  userId    Int
  user      User    @relation(fields: [userId], references: [id])
  cityId    Int
  city      City    @relation(fields: [cityId], references: [id])

  @@map("address")
}

model City {
  id           Int           @id @default(autoincrement())
  name         String
  postalCode   Int
  provinceId   Int
  province     Province      @relation(fields: [provinceId], references: [id], onDelete: Cascade)
  addresses    Address[]
  storeBranchs StoreBranch[]

  @@map("city")
}

model Province {
  id     Int    @id @default(autoincrement())
  name   String
  cities City[]

  @@map("province")
}

model StoreBranch {
  id             Int             @id @default(autoincrement())
  name           String
  latitude       Decimal
  longitude      Decimal
  address        String
  adminId        Int
  admin          Admin           @relation(fields: [adminId], references: [id], onDelete: Cascade)
  cityId         Int
  city           City            @relation(fields: [cityId], references: [id])
  stocks         Stock[]
  stockMutations StockMutation[]
  journals       Journal[]

  @@map("store_branch")
}

model Admin {
  id           Int           @id @default(autoincrement())
  name         String
  email        String
  password     String
  isSuperAdmin Boolean       @default(false)
  storeBranchs StoreBranch[]

  @@map("admin")
}

model Product {
  id          Int         @id @default(autoincrement())
  name        String
  image       String
  price       Decimal
  description String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  categoryId  Int
  category    Category    @relation(fields: [categoryId], references: [id])
  stocks      Stock[]
  orderItems  OrderItem[]

  @@map("product")
}

model Category {
  id       Int       @id @default(autoincrement())
  name     String
  products Product[]

  @@map("category")
}

model Stock {
  id             Int             @id @default(autoincrement())
  amount         Int
  createdAt      DateTime        @default(now())
  updatedAt      DateTime
  productId      Int
  product        Product         @relation(fields: [productId], references: [id])
  branchId       Int
  storeBranch    StoreBranch     @relation(fields: [branchId], references: [id])
  stockMutations StockMutation[]

  @@map("stock")
}

model Order {
  id              Int         @id @default(autoincrement())
  orderId         String      @unique
  branchId        Int?
  amount          Int
  message         String?
  snapToken       String?
  snapRedirectUrl String?
  paymentProof    String?
  address         String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  userId          Int
  user            User        @relation(fields: [userId], references: [id])
  statusId        Int
  status          Status      @relation(fields: [statusId], references: [id])
  orderItems      OrderItem[]

  @@map("order")
}

model OrderItem {
  id          Int      @id @default(autoincrement())
  productName String
  price       Decimal
  quantity    Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  orderId     String
  order       Order    @relation(fields: [orderId], references: [orderId], onDelete: Cascade)
  productId   Int
  product     Product  @relation(fields: [productId], references: [id])

  @@index([productId], map: "productId")
  @@index([orderId], map: "orderId")
  @@map("order_item")
}

model Status {
  id     Int     @id @default(autoincrement())
  title  String
  orders Order[]

  @@map("status")
}

model StockMutation {
  id                  Int         @id @default(autoincrement())
  orderId             String
  productId           Int
  quantity            Int
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt
  stockId             Int
  stock               Stock       @relation(fields: [stockId], references: [id])
  destinationBranchId Int
  storeBranch         StoreBranch @relation(fields: [destinationBranchId], references: [id])

  @@map("stock_mutation")
}

model Journal {
  id          Int         @id @default(autoincrement())
  branchId    Int
  title       String
  reason      String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  storeBranch StoreBranch @relation(fields: [branchId], references: [id])

  @@map("journal")
}
